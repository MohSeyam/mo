#!/usr/bin/env node
import qr from"path";import{promises as Ur}from"fs";import gt from"path";import Ze from"path";var T="1";var V="3";var le="5",ce="6",Ie="7";import ye from"path";var v={"next-app":{name:"next-app",label:"Next.js",links:{installation:"https://ui.shadcn.com/docs/installation/next",tailwind:"https://tailwindcss.com/docs/guides/nextjs"}},"next-pages":{name:"next-pages",label:"Next.js",links:{installation:"https://ui.shadcn.com/docs/installation/next",tailwind:"https://tailwindcss.com/docs/guides/nextjs"}},remix:{name:"remix",label:"Remix",links:{installation:"https://ui.shadcn.com/docs/installation/remix",tailwind:"https://tailwindcss.com/docs/guides/remix"}},vite:{name:"vite",label:"Vite",links:{installation:"https://ui.shadcn.com/docs/installation/vite",tailwind:"https://tailwindcss.com/docs/guides/vite"}},astro:{name:"astro",label:"Astro",links:{installation:"https://ui.shadcn.com/docs/installation/astro",tailwind:"https://tailwindcss.com/docs/guides/astro"}},laravel:{name:"laravel",label:"Laravel",links:{installation:"https://ui.shadcn.com/docs/installation/laravel",tailwind:"https://tailwindcss.com/docs/guides/laravel"}},gatsby:{name:"gatsby",label:"Gatsby",links:{installation:"https://ui.shadcn.com/docs/installation/gatsby",tailwind:"https://tailwindcss.com/docs/guides/gatsby"}},manual:{name:"manual",label:"Manual",links:{installation:"https://ui.shadcn.com/docs/installation/manual",tailwind:"https://tailwindcss.com/docs/installation"}}};import _ from"path";import{cyan as kt,green as Tt,red as It,yellow as jt}from"kleur/colors";var c={error:It,warn:jt,info:kt,success:Tt};import{createMatchPath as Et}from"tsconfig-paths";async function R(e,t){return Et(t.absoluteBaseUrl,t.paths)(e,void 0,()=>!0,[".ts",".tsx"])}import{cosmiconfig as $t}from"cosmiconfig";import{loadConfig as Ot}from"tsconfig-paths";import{z as d}from"zod";var je="@/components",Ee="@/lib/utils",$e="app/globals.css",Oe="tailwind.config.js";var Nt=$t("components",{searchPlaces:["components.json"]}),At=d.object({url:d.string(),style:d.string().optional(),rsc:d.coerce.boolean().optional(),tsx:d.coerce.boolean().optional(),tailwind:d.object({config:d.string().optional(),css:d.string().optional(),baseColor:d.string().optional(),cssVariables:d.boolean().optional(),prefix:d.string().optional()}).optional(),aliases:d.object({components:d.string().optional(),utils:d.string().optional(),ui:d.string().optional(),lib:d.string().optional(),hooks:d.string().optional()}).optional()}),z=d.object({$schema:d.string().optional(),style:d.string(),rsc:d.coerce.boolean().default(!1),tsx:d.coerce.boolean().default(!0),tailwind:d.object({config:d.string(),css:d.string(),baseColor:d.string(),cssVariables:d.boolean().default(!0),prefix:d.string().default("").optional()}),aliases:d.object({components:d.string(),utils:d.string(),ui:d.string().optional(),lib:d.string().optional(),hooks:d.string().optional()}),url:d.string().optional(),registries:d.record(d.string(),At).optional()}).strict(),Ft=z.extend({resolvedPaths:d.object({cwd:d.string(),tailwindConfig:d.string(),tailwindCss:d.string(),utils:d.string(),components:d.string(),lib:d.string(),hooks:d.string(),ui:d.string()})});async function I(e){let t=await Dt(e);return t?await k(e,t):null}async function k(e,t){let r=await Ot(e);if(r.resultType==="failed")throw new Error(`Failed to load ${t.tsx?"tsconfig":"jsconfig"}.json. ${r.message??""}`.trim());return Ft.parse({...t,resolvedPaths:{cwd:e,tailwindConfig:_.resolve(e,t.tailwind.config),tailwindCss:_.resolve(e,t.tailwind.css),utils:await R(t.aliases.utils,r),components:await R(t.aliases.components,r),ui:t.aliases.ui?await R(t.aliases.ui,r):_.resolve(await R(t.aliases.components,r)??e,"ui"),lib:t.aliases.lib?await R(t.aliases.lib,r):_.resolve(await R(t.aliases.utils,r)??e,".."),hooks:t.aliases.hooks?await R(t.aliases.hooks,r):_.resolve(await R(t.aliases.components,r)??e,"..","hooks")}})}async function Dt(e){try{let t=await Nt.search(e);return t?z.parse(t.config):null}catch{let r=`${e}/components.json`;throw new Error(`Invalid configuration found in ${c.info(r)}.`)}}import Lt from"path";import _t from"fs-extra";function Ne(e="",t=!0){let r=Lt.join(e,"package.json");return _t.readJSONSync(r,{throws:t})}import Zt from"path";var a={error(...e){console.log(c.error(e.join(" ")))},warn(...e){console.log(c.warn(e.join(" ")))},info(...e){console.log(c.info(e.join(" ")))},success(...e){console.log(c.success(e.join(" ")))},log(...e){console.log(e.join(" "))},break(){console.log("")}};import{z as zt}from"zod";function b(e){if(a.error("Something went wrong. Please check the error below for more details."),a.error("If the problem persists, please open an issue on GitHub."),a.error(""),typeof e=="string"&&(a.error(e),a.break(),process.exit(1)),e instanceof zt.ZodError){a.error("Validation failed:");for(let[t,r]of Object.entries(e.flatten().fieldErrors))a.error(`- ${c.info(t)}: ${r}`);a.break(),process.exit(1)}e instanceof Error&&(a.error(e.message),a.break(),process.exit(1)),a.break(),process.exit(1)}import{z as m}from"zod";var Ae=m.enum(["registry:style","registry:lib","registry:example","registry:block","registry:component","registry:ui","registry:hook","registry:theme","registry:page"]),Fe=m.object({path:m.string(),content:m.string().optional(),type:Ae,target:m.string().optional()}),Kt=m.object({config:m.object({content:m.array(m.string()).optional(),theme:m.record(m.string(),m.any()).optional(),plugins:m.array(m.string()).optional()}).optional()}),Wt=m.object({light:m.record(m.string(),m.string()).optional(),dark:m.record(m.string(),m.string()).optional()}),F=m.object({name:m.string(),type:Ae,description:m.string().optional(),dependencies:m.array(m.string()).optional(),devDependencies:m.array(m.string()).optional(),registryDependencies:m.array(m.string()).optional(),files:m.array(Fe).optional(),tailwind:Kt.optional(),cssVars:Wt.optional(),meta:m.record(m.string(),m.any()).optional(),docs:m.string().optional()}),pe=m.array(F.extend({files:m.array(m.union([m.string(),Fe])).optional()})),De=m.array(m.object({name:m.string(),label:m.string()})),Le=m.object({inlineColors:m.object({light:m.record(m.string(),m.string()),dark:m.record(m.string(),m.string())}),cssVars:m.object({light:m.record(m.string(),m.string()),dark:m.record(m.string(),m.string())}),inlineColorsTemplate:m.string(),cssVarsTemplate:m.string()}),_e=F.pick({dependencies:!0,devDependencies:!0,files:!0,tailwind:!0,cssVars:!0,docs:!0});import{promises as fe}from"fs";import{tmpdir as Ut}from"os";import K from"path";import Mt from"ora";function y(e,t){return Mt({text:e,isSilent:t?.silent})}import Vt from"deepmerge";import Gt from"stringify-object";import{Project as Bt,QuoteKind as Jt,ScriptKind as ze,SyntaxKind as u}from"ts-morph";async function Ke(e,t,r){if(!e)return;r={silent:!1,...r};let i=K.relative(t.resolvedPaths.cwd,t.resolvedPaths.tailwindConfig),n=y(`Updating ${c.info(i)}`,{silent:r.silent}).start(),s=await fe.readFile(t.resolvedPaths.tailwindConfig,"utf8"),o=await Yt(s,e,t);await fe.writeFile(t.resolvedPaths.tailwindConfig,o,"utf8"),n?.succeed()}async function Yt(e,t,r){let i=await B(e,r),n=i.getDescendantsOfKind(u.ObjectLiteralExpression).find(o=>o.getProperties().some(l=>l.isKind(u.PropertyAssignment)&&l.getName()==="content"));if(!n)return e;let s=me(n);return Qt(n,{name:"darkMode",value:"class"},{quoteChar:s}),t.plugins?.forEach(o=>{Ht(n,o)}),t.theme&&await qt(n,t.theme),i.getFullText()}function Qt(e,t,{quoteChar:r}){let i=e.getProperty("darkMode");if(!i){let n={name:t.name,initializer:`[${r}${t.value}${r}]`};return t.name==="darkMode"?(e.insertPropertyAssignment(0,n),e):(e.addPropertyAssignment(n),e)}if(i.isKind(u.PropertyAssignment)){let n=i.getInitializer(),s=`${r}${t.value}${r}`;if(n?.isKind(u.StringLiteral)){let o=n.getText();return n.replaceWithText(`[${o}, ${s}]`),e}if(n?.isKind(u.ArrayLiteralExpression)){if(n.getElements().map(o=>o.getText()).includes(s))return e;n.addElement(s)}return e}return e}async function qt(e,t){e.getProperty("theme")||e.addPropertyAssignment({name:"theme",initializer:"{}"}),We(e);let i=(e.getPropertyOrThrow("theme")?.asKindOrThrow(u.PropertyAssignment)).getInitializer();if(i?.isKind(u.ObjectLiteralExpression)){let n=i.getText(),s=await Xt(n),o=Vt(s,t),l=Gt(o).replace(/\'\"/g,"'").replace(/\"\'/g,"'").replace(/\'\[/g,"[").replace(/\]\'/g,"]").replace(/\'\\\'/g,"'").replace(/\\\'/g,"'").replace(/\\\'\'/g,"'").replace(/\'\'/g,"'");i.replaceWithText(l)}Me(e)}function Ht(e,t){let r=e.getProperty("plugins");if(!r)return e.addPropertyAssignment({name:"plugins",initializer:`[${t}]`}),e;if(r.isKind(u.PropertyAssignment)){let i=r.getInitializer();if(i?.isKind(u.ArrayLiteralExpression)){if(i.getElements().map(n=>n.getText().replace(/["']/g,"")).includes(t.replace(/["']/g,"")))return e;i.addElement(t)}return e}return e}async function B(e,t){let r=await fe.mkdtemp(K.join(Ut(),"shadcn-")),i=t?.resolvedPaths?.tailwindConfig||"tailwind.config.ts",n=K.join(r,`shadcn-${K.basename(i)}`);return new Bt({compilerOptions:{}}).createSourceFile(n,e,{scriptKind:K.extname(i)===".ts"?ze.TS:ze.JS})}function me(e){return e.getFirstDescendantByKind(u.StringLiteral)?.getQuoteKind()===Jt.Single?"'":'"'}function We(e){let t=e.getProperties();for(let r=0;r<t.length;r++){let i=t[r];if(i.isKind(u.SpreadAssignment)){let n=i.asKindOrThrow(u.SpreadAssignment),s=n.getExpression().getText();e.insertPropertyAssignment(r,{name:`___${s.replace(/^\.\.\./,"")}`,initializer:`"...${s.replace(/^\.\.\./,"")}"`}),n.remove()}else if(i.isKind(u.PropertyAssignment)){let s=i.asKindOrThrow(u.PropertyAssignment).getInitializer();s&&s.isKind(u.ObjectLiteralExpression)&&We(s.asKindOrThrow(u.ObjectLiteralExpression))}}}function Me(e){let t=e.getProperties();for(let r=0;r<t.length;r++){let i=t[r];if(i.isKind(u.PropertyAssignment)){let n=i,s=n.getInitializer();if(s?.isKind(u.StringLiteral)){let o=s.getLiteralValue();o.startsWith("...")&&(e.insertSpreadAssignment(r,{expression:o.slice(3)}),n.remove())}else s?.isKind(u.ObjectLiteralExpression)&&Me(s)}}}async function Xt(e){let r=(await B(`const theme = ${e}`,null)).getStatements()[0];if(r?.getKind()===u.VariableStatement){let n=(r.getDeclarationList()?.getDeclarations()[0]).getInitializer();if(n?.isKind(u.ObjectLiteralExpression))return await Ue(n)}throw new Error("Invalid input: not an object literal")}function Ue(e){let t={};for(let r of e.getProperties())if(r.isKind(u.PropertyAssignment)){let i=r.getName().replace(/\'/g,"");r.getInitializer()?.isKind(u.ObjectLiteralExpression)?t[i]=Ue(r.getInitializer()):t[i]=Ve(r.getInitializer())}return t}function Ve(e){switch(e.kind){case u.StringLiteral:return e.text;case u.NumericLiteral:return Number(e.text);case u.TrueKeyword:return!0;case u.FalseKeyword:return!1;case u.NullKeyword:return null;case u.ArrayLiteralExpression:return e.elements.map(Ve);default:return e.getText()}}function Ge(e){let t={};for(let r of Object.keys(e)){let i=r.split("-"),n=i[0],s=i.slice(1).join("-");s===""?typeof t[n]=="object"?t[n].DEFAULT=`hsl(var(--${r}))`:t[n]=`hsl(var(--${r}))`:(typeof t[n]!="object"&&(t[n]={DEFAULT:`hsl(var(--${n}))`}),t[n][s]=`hsl(var(--${r}))`)}for(let[r,i]of Object.entries(t))typeof i=="object"&&i.DEFAULT===`hsl(var(--${r}))`&&!(r in e)&&delete i.DEFAULT;return t}import W from"deepmerge";import{HttpsProxyAgent as er}from"https-proxy-agent";import tr from"node-fetch";import{z as rr}from"zod";var O=process.env.REGISTRY_URL??"https://ui.shadcn.com/r",ir=process.env.https_proxy?new er(process.env.https_proxy):void 0;async function M(e){try{let[t]=await j(["index.json"],e);return pe.parse(t)}catch(t){a.error(`
`),b(t)}}async function de(e){try{let[t]=await j(["styles/index.json"],e);return De.parse(t)}catch(t){return a.error(`
`),b(t),[]}}async function Be(e,t,r){try{let[i]=await j([ue(e)?e:`styles/${t}/${e}.json`],r,!0);return F.parse(i)}catch(i){return a.break(),b(i),null}}async function ge(){return[{name:"neutral",label:"Neutral"},{name:"gray",label:"Gray"},{name:"zinc",label:"Zinc"},{name:"stone",label:"Stone"},{name:"slate",label:"Slate"}]}async function U(e){try{let[t]=await j([`colors/${e}.json`]);return Le.parse(t)}catch(t){b(t)}}async function Je(e,t){try{let r=t.map(n=>`styles/${e}/${n.name}.json`),i=await j(r);return pe.parse(i)}catch(r){b(r)}}async function Ye(e,t,r){if(r)return r;if(t.type==="registry:ui")return e.resolvedPaths.ui??e.resolvedPaths.components;let[i,n]=t.type?.split(":")??[];return i in e.resolvedPaths?Zt.join(e.resolvedPaths[i],n):null}async function j(e,t,r){try{return await Promise.all(e.map(async n=>{let s=He(n,t),o=await tr(s,{agent:ir});if(!o.ok){let l={400:"Bad request",401:"Unauthorized",403:"Forbidden",404:"Not found",500:"Internal server error"};if(o.status===401)throw new Error(`You are not authorized to access the component at ${c.info(s)}.
If this is a remote registry, you may need to authenticate.`);if(o.status===404)throw new Error(`The component at ${c.info(s)} was not found.
It may not exist at the registry. Please make sure it is a valid component.`);if(o.status===403)throw new Error(`You do not have access to the component at ${c.info(s)}.
If this is a remote registry, you may need to authenticate or a token.`);let p=await o.json(),g=p&&typeof p=="object"&&"error"in p?p.error:o.statusText||l[o.status];throw new Error(`Failed to fetch from ${c.info(s)}.
${g}`)}return o.json()}))}catch(i){return r||(a.error(`
`),b(i)),[]}}function Qe(e,t,r){return r||(e.type==="registry:ui"?t.resolvedPaths.ui:e.type==="registry:lib"?t.resolvedPaths.lib:e.type==="registry:block"||e.type==="registry:component"?t.resolvedPaths.components:e.type==="registry:hook"?t.resolvedPaths.hooks:(e.type==="registry:page",t.resolvedPaths.components))}async function qe(e,t){try{if(!await M(t.url))return null;e.includes("index")&&e.unshift("index");let i=[];for(let f of e){let h=await nr(f,t);i.push(...h)}let n=Array.from(new Set(i)),s=await j(n,t.url),o=rr.array(F).parse(s);if(!o)return null;if(e.includes("index")&&t.tailwind.baseColor){let f=await sr(t.tailwind.baseColor,t);f&&o.unshift(f)}let l={};o.forEach(f=>{l=W(l,f.tailwind??{})});let p={};o.forEach(f=>{p=W(p,f.cssVars??{})});let g="";return o.forEach(f=>{f.docs&&(g+=`${f.docs}
`)}),_e.parse({dependencies:W.all(o.map(f=>f.dependencies??[])),devDependencies:W.all(o.map(f=>f.devDependencies??[])),files:W.all(o.map(f=>f.files??[])),tailwind:l,cssVars:p,docs:g})}catch(r){return b(r),null}}async function nr(e,t){let r=new Set,i=[];async function n(s){let o=He(ue(s)?s:`styles/${t.style}/${s}.json`,t.url);if(!r.has(o)){r.add(o);try{let[l]=await j([o],t.url),p=F.parse(l);if(i.push(o),p.registryDependencies)for(let g of p.registryDependencies)await n(g)}catch(l){console.error(`Error fetching or parsing registry item at ${s}:`,l)}}}return await n(e),Array.from(new Set(i))}async function sr(e,t){let r=await U(e);if(!r)return null;let i={name:e,type:"registry:theme",tailwind:{config:{theme:{extend:{borderRadius:{lg:"var(--radius)",md:"calc(var(--radius) - 2px)",sm:"calc(var(--radius) - 4px)"},colors:{}}}}},cssVars:{light:{radius:"0.5rem"},dark:{}}};return t.tailwind.cssVariables&&(i.tailwind.config.theme.extend.colors={...i.tailwind.config.theme.extend.colors,...Ge(r.cssVars.dark)},i.cssVars={light:{...r.cssVars.light,...i.cssVars.light},dark:{...r.cssVars.dark,...i.cssVars.dark}}),i}function He(e,t){if(ue(e)){let r=new URL(e);return r.pathname.match(/\/chat\/b\//)&&!r.pathname.endsWith("/json")&&(r.pathname=`${r.pathname}/json`),r.toString()}return`${t||O}/${e}`}function ue(e){try{return new URL(e),!0}catch{return!1}}async function he(e,t){if(t==="https://ui.shadcn.com/r")return e;let[r]=await j(["config.json"],t,!0);return r?{...e,...r,tailwind:{...e.tailwind,...r.tailwind},aliases:{...e.aliases,...r.aliases}}:e}import J from"fast-glob";import we from"fs-extra";import{loadConfig as or}from"tsconfig-paths";var Y=["**/node_modules/**",".next","public","dist","build"];async function N(e){let[t,r,i,n,s,o,l]=await Promise.all([J.glob("**/{next,vite,astro}.config.*|gatsby-config.*|composer.json",{cwd:e,deep:3,ignore:Y}),we.pathExists(ye.resolve(e,"src")),pr(e),lr(e),ar(e),cr(e),Ne(e,!1)]),p=await we.pathExists(ye.resolve(e,`${r?"src/":""}app`)),g={framework:v.manual,isSrcDir:r,isRSC:!1,isTsx:i,tailwindConfigFile:n,tailwindCssFile:s,aliasPrefix:o};return t.find(f=>f.startsWith("next.config."))?.length?(g.framework=p?v["next-app"]:v["next-pages"],g.isRSC=p,g):t.find(f=>f.startsWith("astro.config."))?.length?(g.framework=v.astro,g):t.find(f=>f.startsWith("gatsby-config."))?.length?(g.framework=v.gatsby,g):t.find(f=>f.startsWith("composer.json"))?.length?(g.framework=v.laravel,g):Object.keys(l?.dependencies??{}).find(f=>f.startsWith("@remix-run/"))?(g.framework=v.remix,g):(t.find(f=>f.startsWith("vite.config."))?.length&&(g.framework=v.vite),g)}async function ar(e){let t=await J.glob(["**/*.css","**/*.scss"],{cwd:e,deep:5,ignore:Y});if(!t.length)return null;for(let r of t)if((await we.readFile(ye.resolve(e,r),"utf8")).includes("@tailwind base"))return r;return null}async function lr(e){let t=await J.glob("tailwind.config.*",{cwd:e,deep:3,ignore:Y});return t.length?t[0]:null}async function cr(e){let t=await or(e);if(t?.resultType==="failed"||!t?.paths)return null;for(let[r,i]of Object.entries(t.paths))if(i.includes("./*")||i.includes("./src/*")||i.includes("./app/*")||i.includes("./resources/js/*"))return r.at(0)??null;return null}async function pr(e){return(await J.glob("tsconfig.*",{cwd:e,deep:1,ignore:Y})).length>0}async function Xe(e,t=null){let[r,i]=await Promise.all([I(e),t?Promise.resolve(t):N(e)]);if(r)return[{...r,url:O},!1];if(!i||!i.tailwindConfigFile||!i.tailwindCssFile)return null;let n={$schema:"https://ui.shadcn.com/schema.json",rsc:i.isRSC,tsx:i.isTsx,style:"new-york",tailwind:{config:i.tailwindConfigFile,baseColor:"zinc",css:i.tailwindCssFile,cssVariables:!0,prefix:""},aliases:{components:`${i.aliasPrefix}/components`,ui:`${i.aliasPrefix}/components/ui`,hooks:`${i.aliasPrefix}/hooks`,lib:`${i.aliasPrefix}/lib`,utils:`${i.aliasPrefix}/lib/utils`},url:O};return[await k(e,n),!0]}import xe from"fs-extra";async function et(e){let t={};if(!xe.existsSync(e.cwd)||!xe.existsSync(Ze.resolve(e.cwd,"package.json")))return t[T]=!0,{errors:t,projectInfo:null};let r=y("Preflight checks.",{silent:e.silent}).start();xe.existsSync(Ze.resolve(e.cwd,"components.json"))&&!e.force&&(r?.fail(),a.break(),a.error(`A ${c.info("components.json")} file already exists at ${c.info(e.cwd)}.
To start over, remove the ${c.info("components.json")} file and run ${c.info("init")} again.`),a.break(),process.exit(1)),r?.succeed();let i=y("Verifying framework.",{silent:e.silent}).start(),n=await N(e.cwd);(!n||n?.framework.name==="manual")&&(t[Ie]=!0,i?.fail(),a.break(),n?.framework.links.installation&&a.error(`We could not detect a supported framework at ${c.info(e.cwd)}.
Visit ${c.info(n?.framework.links.installation)} to manually configure your project.
Once configured, you can use the cli to add components.`),a.break(),process.exit(1)),i?.succeed(`Verifying framework. Found ${c.info(n.framework.label)}.`);let s=y("Validating Tailwind CSS.",{silent:e.silent}).start();!n?.tailwindConfigFile||!n?.tailwindCssFile?(t[le]=!0,s?.fail()):s?.succeed();let o=y("Validating import alias.",{silent:e.silent}).start();return n?.aliasPrefix?o?.succeed():(t[ce]=!0,o?.fail()),Object.keys(t).length>0&&(t[le]&&(a.break(),a.error(`No Tailwind CSS configuration found at ${c.info(e.cwd)}.`),a.error("It is likely you do not have Tailwind CSS installed or have an invalid configuration."),a.error("Install Tailwind CSS then try again."),n?.framework.links.tailwind&&a.error(`Visit ${c.info(n?.framework.links.tailwind)} to get started.`)),t[ce]&&(a.break(),a.error("No import alias found in your tsconfig.json file."),n?.framework.links.installation&&a.error(`Visit ${c.info(n?.framework.links.installation)} to learn how to set an import alias.`)),a.break(),process.exit(1)),{errors:t,projectInfo:n}}import{promises as tt}from"fs";import fr from"path";import A from"postcss";import mr from"postcss/lib/at-rule";async function it(e,t,r){if(!e||!Object.keys(e).length||!t.resolvedPaths.tailwindCss)return;r={cleanupDefaultNextStyles:!1,silent:!1,...r};let i=t.resolvedPaths.tailwindCss,n=fr.relative(t.resolvedPaths.cwd,i),s=y(`Updating ${c.info(n)}`,{silent:r.silent}).start(),o=await tt.readFile(i,"utf8"),l=await dr(o,e,t,{cleanupDefaultNextStyles:r.cleanupDefaultNextStyles,registryName:r.registryName});await tt.writeFile(i,l,"utf8"),s.succeed()}async function dr(e,t,r,i){i={cleanupDefaultNextStyles:!1,...i};let n=[ur(t,i.registryName)];return i.cleanupDefaultNextStyles&&n.push(hr()),r.tailwind.cssVariables&&n.push(gr(i.registryName)),(await A(n).process(e,{from:void 0})).css}function gr(e){return{postcssPlugin:"update-base-layer",Once(t){let r=[{selector:"*",apply:"border-border"},{selector:"body",apply:"bg-background text-foreground"}],i=t.nodes.find(n=>n.type==="atrule"&&n.name==="layer"&&n.params==="base"&&r.every(({selector:s,apply:o})=>n.nodes?.some(l=>l.type==="rule"&&l.selector===s&&l.nodes.some(p=>p.type==="atrule"&&p.name==="apply"&&p.params===o))));i||(i=A.atRule({name:"layer",params:"base",raws:{semicolon:!0,between:" ",before:`
`}}),t.append(i)),r.forEach(({selector:n,apply:s})=>{i?.nodes?.find(l=>l.type==="rule"&&l.selector===n)||i?.append(A.rule({selector:e?`[data-registry="${e}"] ${n}`:n,nodes:[A.atRule({name:"apply",params:s,raws:{semicolon:!0,before:`
    `}})],raws:{semicolon:!0,between:" ",before:`
  `}}))})}}}function ur(e,t){return{postcssPlugin:"update-css-vars",Once(r){let i=r.nodes.find(n=>n.type==="atrule"&&n.name==="layer"&&n.params==="base");i instanceof mr||(i=A.atRule({name:"layer",params:"base",nodes:[],raws:{semicolon:!0,before:`
`,between:" "}}),r.append(i)),i!==void 0&&Object.entries(e).forEach(([n,s])=>{let o=n==="light"?t?`[data-registry="${t}"]`:":root":t?`[data-registry="${t}"].dark`:".dark";yr(i,o,s)})}}}function rt(e){let t=e.nodes.find(r=>r.type==="rule"&&r.selector===":root");if(t){let r=["--background","--foreground"];t.nodes.filter(i=>i.type==="decl"&&r.includes(i.prop)).forEach(i=>i.remove()),t.nodes.length===0&&t.remove()}}function hr(){return{postcssPlugin:"cleanup-default-next-styles",Once(e){let t=e.nodes.find(i=>i.type==="rule"&&i.selector==="body");t&&(t.nodes.find(i=>i.type==="decl"&&i.prop==="color"&&["rgb(var(--foreground-rgb))","var(--foreground)"].includes(i.value))?.remove(),t.nodes.find(i=>i.type==="decl"&&i.prop==="background"&&(i.value.startsWith("linear-gradient")||i.value==="var(--background)"))?.remove(),t.nodes.length===0&&t.remove()),rt(e);let r=e.nodes.find(i=>i.type==="atrule"&&i.params==="(prefers-color-scheme: dark)");r&&(rt(r),r.nodes.length===0&&r.remove())}}}function yr(e,t,r){let i=e.nodes?.find(n=>n.type==="rule"&&n.selector===t);i||Object.keys(r).length>0&&(i=A.rule({selector:t,raws:{between:" ",before:`
  `}}),e.append(i)),Object.entries(r).forEach(([n,s])=>{let o=`--${n.replace(/^--/,"")}`,l=A.decl({prop:o,value:s,raws:{semicolon:!0}}),p=i?.nodes.find(g=>g.type==="decl"&&g.prop===o);p?p.replaceWith(l):i?.append(l)})}import{detect as wr}from"@antfu/ni";async function Q(e,{withFallback:t}={withFallback:!1}){let r=await wr({programmatic:!0,cwd:e});if(r==="yarn@berry")return"yarn";if(r==="pnpm@6")return"pnpm";if(r==="bun")return"bun";if(!t)return r??"npm";let i=process.env.npm_config_user_agent||"";return i.startsWith("yarn")?"yarn":i.startsWith("pnpm")?"pnpm":i.startsWith("bun")?"bun":"npm"}import{execa as xr}from"execa";async function nt(e,t,r){if(e=Array.from(new Set(e)),!e?.length)return;r={silent:!1,...r};let i=y("Installing dependencies.",{silent:r.silent})?.start(),n=await Q(t.resolvedPaths.cwd);await xr(n,[n==="npm"?"install":"add",...e],{cwd:t.resolvedPaths.cwd}),i?.succeed()}import{existsSync as at,promises as lt}from"fs";import $,{basename as Fr}from"path";import{promises as jr}from"fs";import{tmpdir as Er}from"os";import ot from"path";import{SyntaxKind as br}from"ts-morph";var q=async({sourceFile:e,config:t,baseColor:r})=>(t.tailwind?.cssVariables||!r?.inlineColors||e.getDescendantsOfKind(br.StringLiteral).forEach(i=>{let n=i.getText();if(n){let s=Sr(n.replace(/"/g,""),r.inlineColors);i.replaceWithText(`"${s.trim()}"`)}}),e);function be(e){if(!e.includes("/")&&!e.includes(":"))return[null,e,null];let t=[],[r,i]=e.split("/");if(!r.includes(":"))return[null,r,i];let n=r.split(":"),s=n.pop(),o=n.join(":");return t.push(o??null,s??null,i??null),t}var Cr=["bg-","text-","border-","ring-offset-","ring-"];function Sr(e,t){e.includes(" border ")&&(e=e.replace(" border "," border border-border "));let r=e.split(" "),i=new Set,n=new Set;for(let s of r){let[o,l,p]=be(s),g=Cr.find(h=>l?.startsWith(h));if(!g){i.has(s)||i.add(s);continue}let f=l?.replace(g,"");if(f&&f in t.light){i.add([o,`${g}${t.light[f]}`].filter(Boolean).join(":")+(p?`/${p}`:"")),n.add(["dark",o,`${g}${t.dark[f]}`].filter(Boolean).join(":")+(p?`/${p}`:""));continue}i.has(s)||i.add(s)}return[...Array.from(i),...Array.from(n)].join(" ").trim()}var H=async({sourceFile:e,config:t})=>{let r=e.getImportDeclarations();for(let i of r){let n=Pr(i.getModuleSpecifierValue(),t);i.setModuleSpecifier(n),n=="@/lib/utils"&&i.getNamedImports().find(l=>l.getName()==="cn")&&i.setModuleSpecifier(n.replace(/^@\/lib\/utils/,t.aliases.utils))}return e};function Pr(e,t){if(!e.startsWith("@/"))return e;if(!e.startsWith("@/registry/")){let r=t.aliases.components.charAt(0);return e.replace(/^@\//,`${r}/`)}return e.match(/^@\/registry\/(.+)\/ui/)?e.replace(/^@\/registry\/(.+)\/ui/,t.aliases.ui??`${t.aliases.components}/ui`):t.aliases.components&&e.match(/^@\/registry\/(.+)\/components/)?e.replace(/^@\/registry\/(.+)\/components/,t.aliases.components):t.aliases.lib&&e.match(/^@\/registry\/(.+)\/lib/)?e.replace(/^@\/registry\/(.+)\/lib/,t.aliases.lib):t.aliases.hooks&&e.match(/^@\/registry\/(.+)\/hooks/)?e.replace(/^@\/registry\/(.+)\/hooks/,t.aliases.hooks):e.replace(/^@\/registry\/[^/]+/,t.aliases.components)}import{transformFromAstSync as vr}from"@babel/core";import{parse as Rr}from"@babel/parser";import kr from"@babel/plugin-transform-typescript";import*as X from"recast";var Tr={sourceType:"module",allowImportExportEverywhere:!0,allowReturnOutsideFunction:!0,startLine:1,tokens:!0,plugins:["asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","classStaticBlock","decimal","decorators-legacy","doExpressions","dynamicImport","exportDefaultFrom","exportNamespaceFrom","functionBind","functionSent","importAssertions","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{proposal:"minimal"}],["recordAndTuple",{syntaxType:"hash"}],"throwExpressions","topLevelAwait","v8intrinsic","typescript","jsx"]},st=async({sourceFile:e,config:t})=>{let r=e.getFullText();if(t.tsx)return r;let i=X.parse(r,{parser:{parse:s=>Rr(s,Tr)}}),n=vr(i,r,{cloneInputAst:!1,code:!1,ast:!0,plugins:[kr],configFile:!1});if(!n||!n.ast)throw new Error("Failed to transform JSX");return X.print(n.ast).code};import{SyntaxKind as Ir}from"ts-morph";var Z=async({sourceFile:e,config:t})=>{if(t.rsc)return e;let r=e.getFirstChildByKind(Ir.ExpressionStatement);return r?.getText()==='"use client"'&&r.remove(),e};import{Project as $r,ScriptKind as Or}from"ts-morph";import{SyntaxKind as w}from"ts-morph";var ee=async({sourceFile:e,config:t})=>(t.tailwind?.prefix&&(e.getDescendantsOfKind(w.CallExpression).filter(r=>r.getExpression().getText()==="cva").forEach(r=>{if(r.getArguments()[0]?.isKind(w.StringLiteral)){let i=r.getArguments()[0];i&&i.replaceWithText(`"${E(i.getText()?.replace(/"|'/g,""),t.tailwind.prefix)}"`)}r.getArguments()[1]?.isKind(w.ObjectLiteralExpression)&&r.getArguments()[1]?.getDescendantsOfKind(w.PropertyAssignment).find(i=>i.getName()==="variants")?.getDescendantsOfKind(w.PropertyAssignment).forEach(i=>{i.getDescendantsOfKind(w.PropertyAssignment).forEach(n=>{let s=n.getInitializerIfKind(w.StringLiteral);s&&s?.replaceWithText(`"${E(s.getText()?.replace(/"|'/g,""),t.tailwind.prefix)}"`)})})}),e.getDescendantsOfKind(w.JsxAttribute).forEach(r=>{if(r.getName()==="className"){if(r.getInitializer()?.isKind(w.StringLiteral)){let i=r.getInitializer();i&&i.replaceWithText(`"${E(i.getText()?.replace(/"|'/g,""),t.tailwind.prefix)}"`)}if(r.getInitializer()?.isKind(w.JsxExpression)){let i=r.getInitializer()?.getDescendantsOfKind(w.CallExpression).find(n=>n.getExpression().getText()==="cn");i&&i.getArguments().forEach(n=>{(n.isKind(w.ConditionalExpression)||n.isKind(w.BinaryExpression))&&n.getChildrenOfKind(w.StringLiteral).forEach(s=>{s.replaceWithText(`"${E(s.getText()?.replace(/"|'/g,""),t.tailwind.prefix)}"`)}),n.isKind(w.StringLiteral)&&n.replaceWithText(`"${E(n.getText()?.replace(/"|'/g,""),t.tailwind.prefix)}"`)})}}r.getName()==="classNames"&&r.getInitializer()?.isKind(w.JsxExpression)&&r.getDescendantsOfKind(w.PropertyAssignment).forEach(i=>{if(i.getInitializer()?.isKind(w.CallExpression)){let n=i.getInitializerIfKind(w.CallExpression);n&&n.getArguments().forEach(s=>{s.isKind(w.ConditionalExpression)&&s.getChildrenOfKind(w.StringLiteral).forEach(o=>{o.replaceWithText(`"${E(o.getText()?.replace(/"|'/g,""),t.tailwind.prefix)}"`)}),s.isKind(w.StringLiteral)&&s.replaceWithText(`"${E(s.getText()?.replace(/"|'/g,""),t.tailwind.prefix)}"`)})}if(i.getInitializer()?.isKind(w.StringLiteral)&&i.getName()!=="variant"){let n=i.getInitializer();n&&n.replaceWithText(`"${E(n.getText()?.replace(/"|'/g,""),t.tailwind.prefix)}"`)}})})),e);function E(e,t=""){let r=e.split(" "),i=[];for(let n of r){let[s,o,l]=be(n);s?l?i.push(`${s}:${t}${o}/${l}`):i.push(`${s}:${t}${o}`):l?i.push(`${t}${o}/${l}`):i.push(`${t}${o}`)}return i.join(" ")}var Nr=new $r({compilerOptions:{}});async function Ar(e){let t=await jr.mkdtemp(ot.join(Er(),"shadcn-"));return ot.join(t,e)}async function te(e,t=[H,Z,q,ee]){let r=await Ar(e.filename),i=Nr.createSourceFile(r,e.raw,{scriptKind:Or.TSX});for(let n of t)n({sourceFile:i,...e});return e.transformJsx?await st({sourceFile:i,...e}):i.getText()}import Dr from"prompts";function Lr(e,t,r){return r.startsWith("~/")?$.join(t.resolvedPaths.cwd,r.replace("~/","")):e?.isSrcDir?$.join(t.resolvedPaths.cwd,"src",r):$.join(t.resolvedPaths.cwd,r)}async function ct(e,t,r){if(!e?.length)return;r={overwrite:!1,force:!1,silent:!1,...r};let i=y("Updating files.",{silent:r.silent})?.start(),[n,s]=await Promise.all([N(t.resolvedPaths.cwd),U(t.tailwind.baseColor)]),o=[],l=[],p=[];for(let f of e){if(!f.content)continue;let h=Qe(f,t),S=Fr(f.path),x=$.join(h,S);f.target&&(x=Lr(n,t,f.target),h=$.dirname(x)),t.tsx||(x=x.replace(/\.tsx?$/,ae=>ae===".tsx"?".jsx":".js"));let L=at(x);if(L&&!r.overwrite){i.stop();let{overwrite:ae}=await Dr({type:"confirm",name:"overwrite",message:`The file ${c.info(S)} already exists. Would you like to overwrite?`,initial:!1});if(!ae){p.push($.relative(t.resolvedPaths.cwd,x));continue}i?.start()}at(h)||await lt.mkdir(h,{recursive:!0});let Rt=await te({filename:f.path,raw:f.content,config:t,baseColor:s,transformJsx:!t.tsx},[H,Z,q,ee]);await lt.writeFile(x,Rt,"utf-8"),L?l.push($.relative(t.resolvedPaths.cwd,x)):o.push($.relative(t.resolvedPaths.cwd,x))}if(!(o.length||l.length)&&!p.length&&i?.info("No files updated."),o.length){if(i?.succeed(`Created ${o.length} ${o.length===1?"file":"files"}:`),!r.silent)for(let f of o)a.log(`  - ${f}`)}else i?.stop();if(l.length&&(y(`Updated ${l.length} ${l.length===1?"file":"files"}:`,{silent:r.silent})?.info(),!r.silent))for(let f of l)a.log(`  - ${f}`);if(p.length&&(y(`Skipped ${p.length} ${l.length===1?"file":"files"}:`,{silent:r.silent})?.info(),!r.silent))for(let f of p)a.log(`  - ${f}`);r.silent||a.break()}async function re(e,t,r){r={overwrite:!1,silent:!1,isNewProject:!1,...r};let i=y("Checking registry.",{silent:r.silent})?.start(),n=await qe(e,t);if(!n)return i?.fail(),b(new Error("Failed to fetch components from registry."));i?.succeed(),await Ke(n.tailwind?.config,t,{silent:r.silent}),await it(n.cssVars,t,{cleanupDefaultNextStyles:r.isNewProject,silent:r.silent,registryName:r.registryName}),await nt(n.dependencies,t,{silent:r.silent}),await ct(n.files,t,{overwrite:r.overwrite,silent:r.silent}),n.docs&&a.info(n.docs)}import _r from"path";import{execa as zr}from"execa";import Ce from"fs-extra";import pt from"prompts";async function ie(e){if(e={srcDir:!1,...e},!e.force){let{proceed:o}=await pt({type:"confirm",name:"proceed",message:`The path ${c.info(e.cwd)} does not contain a package.json file. Would you like to start a new ${c.info("Next.js")} project?`,initial:!0});if(!o)return{projectPath:null,projectName:null}}let t=await Q(e.cwd),{name:r}=await pt({type:"text",name:"name",message:"What is your project named?",initial:"my-app",format:o=>o.trim(),validate:o=>o.length>128?"Name should be less than 128 characters.":!0}),i=`${e.cwd}/${r}`;try{await Ce.access(e.cwd,Ce.constants.W_OK)}catch{a.break(),a.error(`The path ${c.info(e.cwd)} is not writable.`),a.error(`It is likely you do not have write permissions for this folder or the path ${c.info(e.cwd)} does not exist.`),a.break(),process.exit(1)}Ce.existsSync(_r.resolve(e.cwd,r,"package.json"))&&(a.break(),a.error(`A project with the name ${c.info(r)} already exists.`),a.error("Please choose a different name and try again."),a.break(),process.exit(1));let n=y("Creating a new Next.js project. This may take a few minutes.").start(),s=["--tailwind","--eslint","--typescript","--app",e.srcDir?"--src-dir":"--no-src-dir","--no-import-alias",`--use-${t}`];try{await zr("npx",["create-next-app@latest",i,"--silent",...s],{cwd:e.cwd})}catch{a.break(),a.error("Something went wrong creating a new Next.js project. Please try again."),process.exit(1)}return n?.succeed("Creating a new Next.js project."),{projectPath:i,projectName:r}}import{promises as ft}from"fs";import Kr from"path";import{SyntaxKind as ne}from"ts-morph";async function mt(e,t,r){if(!e)return;r={silent:!1,...r};let i=Kr.relative(t.resolvedPaths.cwd,t.resolvedPaths.tailwindConfig),n=y(`Updating ${c.info(i)}`,{silent:r.silent}).start(),s=await ft.readFile(t.resolvedPaths.tailwindConfig,"utf8"),o=await Wr(s,e,t);await ft.writeFile(t.resolvedPaths.tailwindConfig,o,"utf8"),n?.succeed()}async function Wr(e,t,r){let i=await B(e,r),n=i.getDescendantsOfKind(ne.ObjectLiteralExpression).find(s=>s.getProperties().some(o=>o.isKind(ne.PropertyAssignment)&&o.getName()==="content"));return n?(Mr(n,t),i.getFullText()):e}async function Mr(e,t){let r=me(e),i=e.getProperty("content");if(!i){let n={name:"content",initializer:`[${r}${t.join(`${r}, ${r}`)}${r}]`};return e.addPropertyAssignment(n),e}if(i.isKind(ne.PropertyAssignment)){let n=i.getInitializer();if(n?.isKind(ne.ArrayLiteralExpression))for(let s of t){let o=`${r}${s}${r}`;n.getElements().map(l=>l.getText()).includes(o)||n.addElement(o)}return e}return e}import{Command as Vr}from"commander";import Gr from"deepmerge";import Pe from"prompts";import{z as P}from"zod";function dt(e,t){if(typeof e=="object"&&e!==null){if(typeof t!="object"||t===null)return!0;for(let r in e)if(dt(e[r],t[r]))return!0;for(let r in t)if(!(r in e))return!0;return!1}return e!==t}function Se(e,t){let r={};for(let i in e)dt(e[i],t[i])&&(typeof e[i]=="object"&&e[i]!==null?(r[i]=Se(e[i],t[i]||{}),Object.keys(r[i]).length===0&&delete r[i]):r[i]=e[i]);return r}var Br=P.object({cwd:P.string(),components:P.array(P.string()).optional(),yes:P.boolean(),defaults:P.boolean(),force:P.boolean(),silent:P.boolean(),isNewProject:P.boolean(),srcDir:P.boolean().optional(),url:P.string().optional(),name:P.string().optional()}),ut=new Vr().name("init").description("initialize your project and install dependencies").argument("[components...]","the components to add or a url to the component.").option("-y, --yes","skip confirmation prompt.",!0).option("-d, --defaults,","use default configuration.",!1).option("-f, --force","force overwrite of existing configuration.",!1).option("-c, --cwd <cwd>","the working directory. defaults to the current directory.",process.cwd()).option("-s, --silent","mute output.",!1).option("--src-dir","use the src directory when creating a new project.",!1).option("-u, --url <url>","registry URL",O).option("-n, --name <name>","registry name").action(async(e,t)=>{try{let r=Br.parse({cwd:gt.resolve(t.cwd),isNewProject:!1,components:e,...t});await se(r),a.log(`${c.success("Success!")} Project initialization completed.
You may now add components.`),a.break()}catch(r){a.break(),b(r)}});async function se(e){let t;if(e.skipPreflight)t=await N(e.cwd);else{let x=await et(e);if(x.errors[T]){let{projectPath:L}=await ie(e);L||process.exit(1),e.cwd=L,e.isNewProject=!0}t=x.projectInfo}let r=await Xe(e.cwd,t),i=r?.[0],n=r?.[1],s;if(i?n||e.url===i.url?(i=await he(i,e.url),s=await ht(i,e)):s=await Yr(i,e):s=await Jr(await I(e.cwd),e.url),!e.yes){let{proceed:x}=await Pe({type:"confirm",name:"proceed",message:`Write configuration to ${c.info("components.json")}. Proceed?`,initial:!0});x||process.exit(0)}s.url===O&&delete s.url;let o=y("Writing components.json.").start(),l=gt.resolve(e.cwd,"components.json");await Ur.writeFile(l,JSON.stringify(s,null,2),"utf8"),o.succeed();let p=s,g,f=e.name??e.url;if(f){let x=s.registries?.[f];x&&(g=f,p=Gr(s,x))}let h=await k(e.cwd,p),S=["index",...e.components||[]];return await re(S,h,{overwrite:!0,silent:e.silent,registryName:g,isNewProject:e.isNewProject||t?.framework.name==="next-app"}),e.isNewProject&&e.srcDir&&await mt(["./src/**/*.{js,ts,jsx,tsx,mdx}"],h,{silent:e.silent}),h}async function Jr(e=null,t){let[r,i]=await Promise.all([de(t),ge()]);a.info("");let n=await Pe([{type:"toggle",name:"typescript",message:`Would you like to use ${c.info("TypeScript")} (recommended)?`,initial:e?.tsx??!0,active:"yes",inactive:"no"},...r.length>1?[{type:"select",name:"style",message:`Which ${c.info("style")} would you like to use?`,choices:r.map(s=>({title:s.label,value:s.name}))}]:[],{type:"select",name:"tailwindBaseColor",message:`Which color would you like to use as the ${c.info("base color")}?`,choices:i.map(s=>({title:s.label,value:s.name}))},{type:"text",name:"tailwindCss",message:`Where is your ${c.info("global CSS")} file?`,initial:e?.tailwind.css??$e},{type:"toggle",name:"tailwindCssVariables",message:`Would you like to use ${c.info("CSS variables")} for theming?`,initial:e?.tailwind.cssVariables??!0,active:"yes",inactive:"no"},{type:"text",name:"tailwindPrefix",message:`Are you using a custom ${c.info("tailwind prefix eg. tw-")}? (Leave blank if not)`,initial:""},{type:"text",name:"tailwindConfig",message:`Where is your ${c.info("tailwind.config.js")} located?`,initial:e?.tailwind.config??Oe},{type:"text",name:"components",message:`Configure the import alias for ${c.info("components")}:`,initial:e?.aliases.components??je},{type:"text",name:"utils",message:`Configure the import alias for ${c.info("utils")}:`,initial:e?.aliases.utils??Ee},{type:"toggle",name:"rsc",message:`Are you using ${c.info("React Server Components")}?`,initial:e?.rsc??!0,active:"yes",inactive:"no"}]);return z.parse({$schema:"https://ui.shadcn.com/schema.json",url:n.url,style:n.style,tailwind:{config:n.tailwindConfig,css:n.tailwindCss,baseColor:n.tailwindBaseColor,cssVariables:n.tailwindCssVariables,prefix:n.tailwindPrefix},rsc:n.rsc,tsx:n.typescript,aliases:{utils:n.utils,components:n.components,lib:n.components.replace(/\/components$/,"lib"),hooks:n.components.replace(/\/components$/,"hooks")}})}async function ht(e,t){let r=e.style,i=e.tailwind.baseColor,n=e.tailwind.cssVariables;if(!t.defaults){let[s,o]=await Promise.all([de(t.url),ge()]),l=await Pe([...s.length>1?[{type:"select",name:"style",message:`Which ${c.info("style")} would you like to use?`,initial:s.findIndex(p=>p.name===r),choices:s.map(p=>({title:p.label,value:p.name}))}]:[],{type:"select",name:"tailwindBaseColor",message:`Which color would you like to use as the ${c.info("base color")}?`,choices:o.map(p=>({title:p.label,value:p.name}))},{type:"toggle",name:"tailwindCssVariables",message:`Would you like to use ${c.info("CSS variables")} for theming?`,initial:e?.tailwind.cssVariables,active:"yes",inactive:"no"}]);r=l.style??r,i=l.tailwindBaseColor??i,n=l.tailwindCssVariables??n}return z.parse({$schema:e?.$schema,style:r,tailwind:{...e?.tailwind,baseColor:i,cssVariables:n},rsc:e?.rsc,tsx:e?.tsx,aliases:e?.aliases,url:t.url,registries:e?.registries})}async function Yr(e,t){let r=await he({...e},t.url),i=await ht(r,t),n=["style","tailwind","rsc","tsx","aliases"],s=Object.fromEntries(n.map(f=>[f,e[f]])),o=Object.fromEntries(n.map(f=>[f,i[f]])),l=Se(o,s);l.url=t.url;let{resolvedPaths:p,...g}=e;return{...g,registries:{...e.registries,[t.name??t.url]:l}}}import yt from"path";import ve from"fs-extra";async function wt(e){let t={};if(!ve.existsSync(e.cwd)||!ve.existsSync(yt.resolve(e.cwd,"package.json")))return t[T]=!0,{errors:t,config:null};if(!ve.existsSync(yt.resolve(e.cwd,"components.json")))return t[V]=!0,{errors:t,config:null};try{let r=await I(e.cwd);return{errors:t,config:r}}catch{a.break(),a.error(`An invalid ${c.info("components.json")} file was found at ${c.info(e.cwd)}.
Before you can add components, you must create a valid ${c.info("components.json")} file by running the ${c.info("init")} command.`),a.error(`Learn more at ${c.info("https://ui.shadcn.com/docs/components-json")}.`),a.break(),process.exit(1)}}import xt from"fs/promises";import Qr from"path";async function bt(e,t){let r=Qr.join(t.resolvedPaths.cwd,"app/page.tsx");if(!(await xt.stat(r)).isFile())return;let i=await Be(e,t.style);if(!i?.meta?.importSpecifier||!i?.meta?.moduleSpecifier)return;let n=`import { ${i?.meta?.importSpecifier} } from "${i.meta.moduleSpecifier}"

export default function Page() {
  return <${i?.meta?.importSpecifier} />
}`;await xt.writeFile(r,n,"utf8")}import{Command as Hr}from"commander";import Re from"deepmerge";import oe from"prompts";import{z as C}from"zod";var Xr=C.object({components:C.array(C.string()).optional(),yes:C.boolean(),overwrite:C.boolean(),cwd:C.string(),all:C.boolean(),path:C.string().optional(),silent:C.boolean(),srcDir:C.boolean().optional(),registry:C.string().optional(),list:C.boolean().optional()}),Ct=new Hr().name("add").description("add a component to your project").argument("[components...]","the components to add or a url to the component.").option("-y, --yes","skip confirmation prompt.",!1).option("-o, --overwrite","overwrite existing files.",!1).option("-c, --cwd <cwd>","the working directory. defaults to the current directory.",process.cwd()).option("-a, --all","add all available components",!1).option("-p, --path <path>","the path to add the component to.").option("-s, --silent","mute output.",!1).option("--src-dir","use the src directory when creating a new project.",!1).option("-r, --registry <registry>","registry name or url").option("-l, --list","list all available registries",!1).action(async(e,t)=>{try{let r=Xr.parse({components:e,cwd:qr.resolve(t.cwd),...t}),i=r.components?.some(p=>p.includes("theme-"));if(!r.yes&&i){a.break();let{confirm:p}=await oe({type:"confirm",name:"confirm",message:c.warn(`You are about to install a new theme. 
Existing CSS variables will be overwritten. Continue?`)});p||(a.break(),a.log("Theme installation cancelled."),a.break(),process.exit(1))}let{errors:n,config:s}=await wt(r);if(n[V]){let{proceed:p}=await oe({type:"confirm",name:"proceed",message:`You need to create a ${c.info("components.json")} file to add components. Proceed?`,initial:!0});p||(a.break(),process.exit(1)),s=await se({cwd:r.cwd,yes:!0,force:!0,defaults:!1,skipPreflight:!1,silent:!0,isNewProject:!1,srcDir:r.srcDir,url:r.registry})}let o=await Zr(s,r);r.components?.length||(r.components=await ei(r,o.url));let l=!1;if(n[T]){let{projectPath:p}=await ie({cwd:r.cwd,force:r.overwrite,srcDir:r.srcDir});p||(a.break(),process.exit(1)),r.cwd=p,s=await se({cwd:r.cwd,yes:!0,force:!0,defaults:!1,skipPreflight:!0,silent:!0,isNewProject:!0,srcDir:r.srcDir,url:r.registry}),l=r.components?.length===1&&!!r.components[0].match(/\/chat\/b\//)}if(!s)throw new Error(`Failed to read config at ${c.info(r.cwd)}.`);await re(r.components,o,r),l&&await bt(r.components[0],s)}catch(r){a.break(),b(r)}});async function Zr(e,t){let{registry:r}=t;if(t.list&&e.registries&&Object.keys(e.registries).length>0){let{selectedRegistry:i}=await oe({type:"select",name:"selectedRegistry",message:"Select a registry:",choices:[{title:"default",value:"default"},...Object.entries(e.registries).map(([n,s])=>({title:n,value:n}))]});return i==="default"?{...e}:await k(t.cwd,Re(e,e.registries[i]))}if(r){if(r.startsWith("http://")||r.startsWith("https://")){if(e.registries){let i=Object.values(e.registries)?.find(n=>n.url===r);if(i)return await k(t.cwd,Re(e,i))}return{...e,url:r}}return e.registries?.[r]?await k(t.cwd,Re(e,e.registries[r])):(a.warn(`Registry "${r}" not found in configuration. Using the default registry.`),{...e})}return{...e}}async function ei(e,t){let r=await M(t);if(!r)return a.break(),b(new Error("Failed to fetch registry index.")),[];if(e.all)return r.map(s=>s.name);if(e.components?.length)return e.components;let{components:i}=await oe({type:"multiselect",name:"components",message:"Which components would you like to add?",hint:"Space to select. A to toggle all. Enter to submit.",instructions:!1,choices:r.filter(s=>s.type==="registry:ui").map(s=>({title:s.name,value:s.name,selected:e.all?!0:e.components?.includes(s.name)}))});i?.length||(a.warn("No components selected. Exiting."),a.info(""),process.exit(1));let n=C.array(C.string()).safeParse(i);return n.success?n.data:(a.error(""),b(new Error("Something went wrong. Please try again.")),[])}import{existsSync as ke,promises as ti}from"fs";import Te from"path";import{Command as ri}from"commander";import{diffLines as ii}from"diff";import{z as D}from"zod";var ni=D.object({component:D.string().optional(),yes:D.boolean(),cwd:D.string(),path:D.string().optional(),registry:D.string().optional()}),Pt=new ri().name("diff").description("check for updates against the registry").argument("[component]","the component name").option("-y, --yes","skip confirmation prompt.",!1).option("-c, --cwd <cwd>","the working directory. defaults to the current directory.",process.cwd()).option("--registry <url>","custom registry URL").action(async(e,t)=>{try{let r=ni.parse({component:e,...t}),i=Te.resolve(r.cwd);ke(i)||(a.error(`The path ${i} does not exist. Please try again.`),process.exit(1));let n=await I(i);n||(a.warn(`Configuration is missing. Please run ${c.success("init")} to create a components.json file.`),process.exit(1));let s=await M(r.registry);if(s||(b(new Error("Failed to fetch registry index.")),process.exit(1)),!r.component){let p=n.resolvedPaths.components,g=s.filter(h=>{for(let S of h.files??[]){let x=Te.resolve(p,typeof S=="string"?S:S.path);if(ke(x))return!0}return!1}),f=[];for(let h of g){let S=await St(h,n);S.length&&f.push({name:h.name,changes:S})}f.length||(a.info("No updates found."),process.exit(0)),a.info("The following components have updates available:");for(let h of f){a.info(`- ${h.name}`);for(let S of h.changes)a.info(`  - ${S.filePath}`)}a.break(),a.info(`Run ${c.success("diff <component>")} to see the changes.`),process.exit(0)}let o=s.find(p=>p.name===r.component);o||(a.error(`The component ${c.success(r.component)} does not exist.`),process.exit(1));let l=await St(o,n);l.length||(a.info(`No updates found for ${r.component}.`),process.exit(0));for(let p of l)a.info(`- ${p.filePath}`),await si(p.patch),a.info("")}catch(r){b(r)}});async function St(e,t){let r=await Je(t.style,[e]),i=await U(t.tailwind.baseColor);if(!r)return[];let n=[];for(let s of r){let o=await Ye(t,s);if(o)for(let l of s.files??[]){let p=Te.resolve(o,typeof l=="string"?l:l.path);if(!ke(p))continue;let g=await ti.readFile(p,"utf8");if(typeof l=="string"||!l.content)continue;let f=await te({filename:l.path,raw:l.content,config:t,baseColor:i}),h=ii(f,g);h.length>1&&n.push({filePath:p,patch:h})}}return n}async function si(e){e.forEach(t=>{if(t)return t.added?process.stdout.write(c.success(t.value)):t.removed?process.stdout.write(c.error(t.value)):process.stdout.write(t.value)})}import{Command as ai}from"commander";var vt={name:"@udecode/plate-ui",version:"34.0.2",description:"Add Plate components to your apps.",keywords:["components","plate","slate","ui","tailwind","radix-ui","shadcn"],homepage:"https://platejs.org",bugs:{url:"https://github.com/udecode/plate/issues"},repository:{type:"git",url:"https://github.com/udecode/plate.git",directory:"packages/cli"},license:"MIT",sideEffects:!1,type:"module",exports:{".":{types:"./dist/index.d.ts",import:"./dist/index.mjs",module:"./dist/index.mjs",require:"./dist/index.js"}},main:"dist/index.js",module:"dist/index.mjs",types:"dist/index.d.ts",bin:"./dist/index.js",files:["dist/**/*"],scripts:{build:"yarn tsup","build:watch":"yarn tsup --watch",clean:"yarn p:clean && rimraf components",dev:"COMPONENTS_REGISTRY_URL=http://localhost:3000 node dist/index.js",lint:"yarn p:lint","lint:fix":"yarn p:lint:fix",start:"node dist/index.js",test:"vitest run","test:watch":"yarn p:test:watch",typecheck:"yarn p:typecheck"},dependencies:{"@antfu/ni":"^0.21.4","@babel/core":"^7.22.1","@babel/parser":"^7.22.6","@babel/plugin-transform-typescript":"^7.22.5",commander:"^10.0.0",cosmiconfig:"^8.1.3",deepmerge:"^4.3.1",diff:"^5.1.0",execa:"^7.0.0","fast-glob":"^3.3.2","fs-extra":"^11.1.0","https-proxy-agent":"^6.2.0",kleur:"^4.1.5","lodash.template":"^4.5.0","node-fetch":"^3.3.0",ora:"^6.1.2",postcss:"^8.4.24",prompts:"^2.4.2",recast:"^0.23.2","stringify-object":"^5.0.0","ts-morph":"^18.0.0","tsconfig-paths":"^4.2.0",zod:"^3.20.2"},devDependencies:{"@types/babel__core":"^7.20.1","@types/diff":"^5.0.3","@types/fs-extra":"^11.0.1","@types/lodash.template":"^4.5.1","@types/prompts":"^2.4.2","@types/stringify-object":"^4.0.5",rimraf:"^6.0.1",tsup:"^6.6.3","type-fest":"^3.8.0",typescript:"^4.9.3"},publishConfig:{access:"public"}};process.on("SIGINT",()=>process.exit(0));process.on("SIGTERM",()=>process.exit(0));async function li(){let e=new ai().name("shadcn").description("add components and dependencies to your project").version(vt.version||"1.0.0","-v, --version","display the version number");e.addCommand(ut).addCommand(Ct).addCommand(Pt),e.parse()}li();
//# sourceMappingURL=index.js.map